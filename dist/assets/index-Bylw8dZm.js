(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();class R extends Phaser.Scene{constructor(){super("preload")}preload(){this.load.image("Calle","public/assets/Calle.png"),this.load.image("Celeste1","public/assets/1.png"),this.load.image("Naranja2","public/assets/2.png"),this.load.image("Celeste","public/assets/Celeste.png"),this.load.image("Naranja","public/assets/Naranja.png"),this.load.image("Auto","public/assets/auto.png"),this.load.image("Camion","public/assets/Camion.png"),this.load.image("Camion2","public/assets/Camion2.png"),this.load.image("Moto","public/assets/Moto.png"),this.load.image("Arena","public/assets/Arena.png"),this.load.image("Balde","public/assets/Balde.png"),this.load.image("BaldeArena","public/assets/BaldeArena.png"),this.load.image("BaldeGrava","public/assets/BaldeGrava.png"),this.load.image("BaldeCemento","public/assets/BaldeCemento.png"),this.load.image("Barrera","public/assets/BloqueDivisor.png"),this.load.image("Borde","public/assets/Borde.png"),this.load.image("Carretilla","public/assets/Carretilla.png"),this.load.image("Cemento","public/assets/Cemento.png"),this.load.image("Coca","public/assets/Coca.png"),this.load.image("Construccion","public/assets/Construccion.png"),this.load.image("Construccion2","public/assets/Construccion2.png"),this.load.image("Construccion3","public/assets/Construccion3.png"),this.load.image("Cuchara","public/assets/Cuchara.png"),this.load.image("Espatula","public/assets/Espatula.png"),this.load.image("Grava","public/assets/Grava.png"),this.load.image("Ladrillos","public/assets/Ladrillos.png"),this.load.image("Ladrillo","public/assets/Ladrillo.png"),this.load.image("Llana","public/assets/Llana.png"),this.load.image("Mezcladora","public/assets/Mezcladora.png"),this.load.image("MezcladoraLlena","public/assets/MezcladoraLlena.png"),this.load.image("MiraCeleste","public/assets/MiraCeleste.png"),this.load.image("MiraNaranja","public/assets/MiraNaranja.png"),this.load.image("Pala","public/assets/Pala.png"),this.load.image("Pared","public/assets/Pared.png"),this.load.image("Pasto","public/assets/Pasto.png"),this.load.image("Pasto2","public/assets/Pasto2.png"),this.load.image("PastoDetalle","public/assets/PastoDetalle.png"),this.load.image("Sombreado","public/assets/Sombreado.png"),this.load.audio("Arena","public/assets/Arena.mp3"),this.load.audio("Bocina","public/assets/Bocina.mp3"),this.load.audio("Bocina2","public/assets/Bocina2.mp3"),this.load.audio("Bocina3","public/assets/Bocina3.mp3"),this.load.audio("RecGrava","public/assets/RecGrava.mp3"),this.load.audio("SonidoCarretera","public/assets/SonidoCarretera.mp3"),this.load.audio("SonidoCarretera2","public/assets/SonidoCarretera2.mp3"),this.load.audio("SonidoConstruccion","public/assets/sonidoConstruccion.mp3"),this.load.audio("RuidoMoto","public/assets/mentiraColgala.mp3"),this.load.video("Intro","public/assets/TelevisaPresenta.mp4")}create(){const e=this.cameras.main.width/2,t=this.cameras.main.height/2;this.add.image(e,t,"Pasto2"),this.add.text(e,t-40,"MODO COOPERATIVO",{fontFamily:"ActionComicsBlack",fontSize:"32px",fill:"#fff",stroke:"#000",strokeThickness:6,backgroundColor:"#007bff",padding:{x:20,y:10}}).setOrigin(.5).setInteractive().on("pointerdown",()=>{this.scene.start("game")}),this.add.text(e,t+100,"MODO PVP",{fontFamily:"ActionComicsBlack",fontSize:"32px",fill:"#fff",stroke:"#000",strokeThickness:6,backgroundColor:"#e70a0aff",padding:{x:20,y:10}}).setOrigin(.5).setInteractive().on("pointerdown",()=>{this.scene.start("gamepvp")})}}class E extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,a){super(e,t,i,a),e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0).setScale(.3).refreshBody(),this.ladrillos=[],this.velocidadBase=250,this.aiming=!1,this.aimCursor=null,this.ManosOcupadas=!1,this.llevaLadrillo=!1,this.llevaBalde=!1,this.Intangible=!1,this.Aturdido=!1,this.vaciarTimer=null}startAiming(){if(!this.ladrillos||this.ladrillos.length===0||this.aiming)return;this.aiming=!0;const e=this.scene,t=this.texture&&this.texture.key==="Naranja"?"MiraNaranja":"MiraCeleste";!this.aimCursor||!this.aimCursor.scene?this.aimCursor=e.add.image(this.x,this.y,t).setScale(.25).setDepth(3).setAlpha(.95):(this.aimCursor.texture&&this.aimCursor.texture.key!==t&&this.aimCursor.setTexture(t),this.aimCursor.setVisible(!0),this.aimCursor.x=this.x+80,this.aimCursor.y=this.y),this.setVelocity(0)}cancelAiming(){this.aiming=!1,this.aimCursor&&(this.aimCursor.destroy(),this.aimCursor=null)}lanzarLadrillo(){const e=this.scene;if(!this.ladrillos||this.ladrillos.length===0){this.cancelAiming();return}if(e.physics.overlap(this,e.Construccion)){e.Construccion.recibirLadrillo(this),this.cancelAiming();return}const t=this.ladrillos.pop();if(!t){this.cancelAiming();return}this.ladrillos.length===0&&(this.ManosOcupadas=!1,this.llevaLadrillo=!1),t.portadorLadrillo=null,t.x=this.x+20,t.y=this.y,t.setDepth(2),t.setRotation(0),t.thrower=this,t.thrown=!0,t._pufMostrado=!1,t.body&&(t.body.enable=!0,t.setCollideWorldBounds(!0),t.body.onWorldBounds=!0,t.setBounce(.35));const i=this.aimCursor?this.aimCursor.x:this.x+200,a=this.aimCursor?this.aimCursor.y:this.y,s=(r,h)=>{if(typeof r!="number"||typeof h!="number")return;const m=e.add.text(r,h,"BONK",{fontFamily:"ActionComicsBlack",fontSize:"28px",color:"#d63c15ff",stroke:"#000000",strokeThickness:4}).setDepth(2).setOrigin(.5);e.tweens.add({targets:m,y:h-30,alpha:0,duration:1500,ease:"Cubic.easeOut",onComplete:()=>{m&&m.destroy&&m.destroy()}})};let o=null;const d=r=>{!r||r._pufMostrado||(r._pufMostrado=!0,o&&e.physics.world.off("worldbounds",o),r&&r.x!=null&&r.y!=null&&s(r.x,r.y),r&&r.destroy&&r.destroy())},f=(r,h)=>{if(!(!r||r===t.thrower)&&!(r.Intangible||r.Aturdido))if(r.Intangible=!0,r.Aturdido=!0,r.setTint(16711680),r.body&&h){const m=r.x-h.x,b=r.y-h.y,g=Math.max(1,Math.hypot(m,b)),x=m/g,k=b/g,c=100,M=.22,S=120,I=r.body.velocity.x,n=r.body.velocity.y;let l=I+x*c,y=n+k*(c*M);const v=200,D=Math.hypot(l,y);if(D>v){const N=v/D;l*=N,y*=N}e.tweens.addCounter({from:0,to:1,duration:S,ease:"Quad.easeOut",onUpdate:N=>{const P=N.getValue();r&&r.body&&(r.body.velocity.x=I+(l-I)*P,r.body.velocity.y=n+(y-n)*P)},onComplete:()=>{r&&r.body&&r.setVelocity(0,0),e.time.delayedCall(2e3,()=>{r.Aturdido=!1,r.Intangible=!1,r.setTint(16777215),r.alpha=1})}})}else e.time.delayedCall(2e3,()=>{r.Aturdido=!1,r.Intangible=!1,r.setTint(16777215),r.alpha=1,r&&r.body&&(r.body.enable=!0)})},C=Phaser.Math.Distance.Between(t.x,t.y,i,a),p=2500;if(C<=2)t.setVelocity(0,0),t.setAngularVelocity(0);else{const r=Phaser.Math.Angle.Between(t.x,t.y,i,a),h=Math.cos(r)*p,m=Math.sin(r)*p;t.body&&(t.body.setAllowGravity(!1),t.body.setDrag(0,0),t.body.setMaxVelocity(p*2,p*2),t.body.enable=!0,t.setVelocity(h,m)),t.setAngularVelocity(Phaser.Math.Between(300,900));const b=C/p*1e3;o=g=>{g&&g.gameObject===t&&d(t)},e.physics.world.on("worldbounds",o),e.time.delayedCall(Math.max(50,b),()=>{d(t)})}e.physics.add.collider(t,e.Celeste,(r,h)=>{if(r.thrower!==h){if(e.Balde.portadorBalde===h&&e.Balde.soltarBalde(h),h.ladrillos&&h.ladrillos.length>0){const m=h.x-r.x,b=h.y-r.y,g=Math.max(1,Math.hypot(m,b)),x=m/g,k=b/g;for(;h.ladrillos.length>0;){const c=h.ladrillos[h.ladrillos.length-1];h.ladrillos.pop(),c.portadorLadrillo=null,c.x=h.x+Phaser.Math.Between(-10,10),c.y=h.y+Phaser.Math.Between(-10,10),c.setDepth(2),c.setRotation(0),c.body&&(c.body.enable=!1);const M=Phaser.Math.Between(80,120),S=h.x+x*M+Phaser.Math.Between(-30,30),I=h.y+k*M+Phaser.Math.Between(-30,30);e.tweens.add({targets:c,x:S,y:I,angle:Phaser.Math.Between(360,1080),duration:400,ease:"Cubic.easeOut",onComplete:()=>{c.body&&(c.body.enable=!0,c.setBounce(.35),c.setAngularVelocity(0),c.setCollideWorldBounds(!0),c.body.onWorldBounds=!0),c.setInteractive(),e.physics.add.overlap(e.Celeste,c,()=>{const n=e.toca.Ladrillo.Celeste;n.includes(c)||n.push(c)},null,e),e.physics.add.overlap(e.Naranja,c,()=>{const n=e.toca.Ladrillo.Naranja;n.includes(c)||n.push(c)},null,e)}})}h.ManosOcupadas=!1,h.llevaLadrillo=!1}f(h,r),d(r)}},null,e),e.physics.add.collider(t,e.Naranja,(r,h)=>{if(r.thrower!==h){if(e.Balde.portadorBalde===h&&e.Balde.soltarBalde(h),h.ladrillos&&h.ladrillos.length>0){const m=h.x-r.x,b=h.y-r.y,g=Math.max(1,Math.hypot(m,b)),x=m/g,k=b/g;for(;h.ladrillos.length>0;){const c=h.ladrillos[h.ladrillos.length-1];h.ladrillos.pop(),c.portadorLadrillo=null,c.x=h.x+Phaser.Math.Between(-10,10),c.y=h.y+Phaser.Math.Between(-10,10),c.setDepth(2),c.setRotation(0),c.body&&(c.body.enable=!1);const M=Phaser.Math.Between(80,120),S=h.x+x*M+Phaser.Math.Between(-30,30),I=h.y+k*M+Phaser.Math.Between(-30,30);e.tweens.add({targets:c,x:S,y:I,angle:Phaser.Math.Between(360,1080),duration:400,ease:"Cubic.easeOut",onComplete:()=>{c.body&&(c.body.enable=!0,c.setBounce(.35),c.setAngularVelocity(0),c.setCollideWorldBounds(!0),c.body.onWorldBounds=!0),c.setInteractive(),e.physics.add.overlap(e.Celeste,c,()=>{const n=e.toca.Ladrillo.Celeste;n.includes(c)||n.push(c)},null,e),e.physics.add.overlap(e.Naranja,c,()=>{const n=e.toca.Ladrillo.Naranja;n.includes(c)||n.push(c)},null,e)}})}h.ManosOcupadas=!1,h.llevaLadrillo=!1}f(h,r),d(r)}},null,e),this.cancelAiming()}}class G extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,a){super(e,t,i,a),e.add.existing(this),e.physics.add.existing(this),this.setScale(.25),this.setCollideWorldBounds(!1),this.setImmovable(!0),this._velocidad=0,this._direction=1,this.blinkEvent=null,this.ultimaFraseChoque=null}configure({velocidad:e=600,color:t=16777215,direction:i=1,flipY:a=null,scale:s=.25,immovable:o=!0}={}){this._velocidad=e,this._direction=i,this.setTint(t),this.setScale(s),this.setImmovable(o),this.setDepth(2),this.setVelocityY(e*i),a===null?this.setFlipY(i<0):this.setFlipY(!!a)}preUpdate(e,t){super.preUpdate(e,t);const i=this.scene.cameras.main;(this.y>i.height+this.height||this.y<-this.height)&&this.destroy()}handleCollision(e){if(!e.Intangible&&!e.Aturdido){e.aiming&&(e.aiming=!1,e.aimCursor&&(e.aimCursor.destroy(),e.aimCursor=null)),e.Intangible=!0,e.Aturdido=!0;const t=["#ffffff"];this.scene.cameras.main.shake(100,.005);let i=!1;if(e.ladrillos&&e.ladrillos.length>0){const d=this._direction,f=Phaser.Math.Between(0,e.ladrillos.length-1),C=[...e.ladrillos];e.ladrillos.length=0,C.forEach((p,r)=>{if(!i&&r===f&&Phaser.Math.Between(1,3)===1){const x=["NOOO!","EL LADRILLO NO!","CHAU LADRILLO!","VOS PODES CREER?","ME MATO!","NOO, MI LADRILLO!","UH, ME LA MANDE!"];this.scene.ultimaFraseRoto||(this.scene.ultimaFraseRoto=null);let k;do k=Phaser.Utils.Array.GetRandom(x);while(k===this.scene.ultimaFraseRoto&&x.length>1);this.scene.ultimaFraseRoto=k;const c=this.scene.add.text(p.x,p.y-50,k,{fontFamily:"ActionComicsBlack",fontSize:"24px",color:t,stroke:"#000000ff",strokeThickness:4}).setOrigin(.5).setDepth(2);this.scene.tweens.add({targets:c,y:c.y-100,alpha:0,duration:1500,onComplete:()=>c.destroy()}),p.destroy(),i=!0;return}p.portadorLadrillo=null;const h=Phaser.Math.Between(-80,80),m=Phaser.Math.Between(160,200)*d,b=e.x+h,g=e.y+m;p.setDepth(0),p.setInteractive(),p.body.enable=!1,this.scene.tweens.add({targets:p,x:b,y:g,angle:Phaser.Math.Between(360,1080),duration:400,ease:"Cubic.easeOut",onComplete:()=>{p.body.enable=!0,this.scene.tweens.add({targets:p,angle:p.angle+Phaser.Math.Between(90,180),duration:600,ease:"Cubic.easeOut"}),this.scene&&this.scene.toca&&this.scene.toca.Ladrillo&&this.scene.Celeste&&this.scene.Naranja&&(this.scene.physics.add.overlap(this.scene.Celeste,p,function(){const x=this.toca.Ladrillo.Celeste;x&&!x.includes(p)&&x.push(p)},null,this.scene),this.scene.physics.add.overlap(this.scene.Naranja,p,function(){const x=this.toca.Ladrillo.Naranja;x&&!x.includes(p)&&x.push(p)},null,this.scene))}})}),e.ManosOcupadas=!1,e.llevaLadrillo=!1}if(!i){const d=["UPS!","AUCH!","NOOO!","LAPU!","OTRA VEZ?!","CUIDADO!","ESE DOLIÓ!","MIRA POR DONDE MANEJAS","A DONDE REGALAN EL CARNET?"];let f;do f=Phaser.Utils.Array.GetRandom(d);while(f===this.scene.ultimaFraseChoque&&d.length>1);this.scene.ultimaFraseChoque=f;const C=this.scene.add.text(e.x,e.y-100,f,{fontFamily:"ActionComicsBlack",fontSize:"24px",color:t,stroke:"#000000ff",strokeThickness:4}).setOrigin(.5).setDepth(2);this.scene.tweens.add({targets:C,y:C.y-100,alpha:0,duration:1500,onComplete:()=>C.destroy()})}const s=80*this._direction,o=e.y+s;e.body.enable=!1,this.scene.tweens.add({targets:e,y:o,duration:350,ease:"Cubic.easeOut",onComplete:()=>{e.body.enable=!0}}),e.blinkEvent=this.scene.time.addEvent({delay:200,callback:()=>{e.alpha=e.alpha===.5?1:.5},repeat:24}),e.alpha=.5,e.setTint(16711680),this.scene.time.delayedCall(3e3,()=>{e.Aturdido=!1,e.alpha=.5,e.setTint(16777215),e.body.enable=!0}),this.scene.time.delayedCall(5e3,()=>{e.Intangible=!1,e.body.enable=!0,e.alpha=1,e.blinkEvent&&(e.blinkEvent.remove(),e.blinkEvent=null)})}}}class B extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,a){if(super(e,t,i,a),e.add.existing(this),e.physics.add.existing(this),this.setImmovable(!0).setDepth(1),a==="Arena"||a==="Grava"||a==="Ladrillos"||a==="Mezcladora"){const s=this.width*this.scaleX,o=this.height*this.scaleY;this.body.setSize(s,o/2),this.body.setOffset(0,o/2),this.hitboxInterna=e.add.rectangle(t,i+5,s*.45,o*.01,16711680,0),e.physics.add.existing(this.hitboxInterna,!0)}this.portadorBalde=null,this.lleno=!1,this.portadorLadrillo=null,a==="Construccion"&&(this.cementoNecesario=Phaser.Math.Between(2,3),this.ladrilloNecesario=Phaser.Math.Between(10,12),this.cementoCount=0,this.ladrilloCount=0),a==="Mezcladora"&&(this.arenaCount=0,this.gravaCount=0)}interactuarBalde(e,t){this.scene.physics.overlap(e,this)&&!e.ManosOcupadas&&!e.Aturdido&&this.portadorBalde===null?this.cargarBalde(e):this.portadorBalde===e&&this.soltarBalde(e)}cargarBalde(e){e.ManosOcupadas=!0,e.llevaBalde=!0,this.portadorBalde=e,console.log(`${e.texture.key} levantó el ${this.texture.key}`)}soltarBalde(e){e.ManosOcupadas=!1,e.llevaBalde=!1,this.portadorBalde=null,this.x=e.x+30,this.y=e.y+30,this.setDepth(0),console.log(`${e.texture.key} soltó el ${this.texture.key}`)}llenarBalde(e,t,i){Phaser.Input.Keyboard.JustDown(t)&&this.texture.key==="Balde"&&!this.lleno&&(i.texture.key==="Arena"?(this.setTexture("BaldeArena"),this.scene.sound.play("Arena",{rate:3}),this.lleno=!0,console.log(`${e.texture.key} llenó el balde con arena`)):i.texture.key==="Grava"?(this.setTexture("BaldeGrava"),this.scene.sound.play("RecGrava",{volume:3}),this.lleno=!0,console.log(`${e.texture.key} llenó el balde con grava`)):i.texture.key==="Cemento"&&(i.usosRestantes>0?(this.setTexture("BaldeCemento"),this.lleno=!0,i.usosRestantes--,console.log(`${e.texture.key} llenó el balde con cemento. Usos restantes: ${i.usosRestantes}`),i.usosRestantes<=0&&(i.destroy(),this.scene.Mezcladora.setTexture("Mezcladora"),this.scene.Cemento=null,console.log("El cemento se ha agotado y desaparece."))):console.log("¡No queda más cemento!")))}vaciarBalde=()=>{this.scene.Balde.setTexture("Balde"),this.scene.Balde.lleno=!1};interactuarLadrillos(e){this.scene.physics.overlap(e,this)&&!e.ManosOcupadas&&!e.Aturdido&&this.portadorLadrillo===null?(this.levantarLadrillo(e),console.log(`${e.texture.key} levantó ladrillos`)):this.portadorLadrillo===e&&(this.soltarLadrillo(e),console.log(`${e.texture.key} soltó el ladrillo`))}levantarLadrillo(e){if(e.ladrillos.length===0&&!e.Aturdido){e.ManosOcupadas=!0,e.llevaLadrillo=!0;for(let t=0;t<3;t++){const i=25-t*18,a=new B(this.scene,e.x+20,e.y+i,"Ladrillo").setScale(.5).setDepth(1);a.portadorLadrillo=e,e.ladrillos.push(a)}e.ladrillos.forEach((t,i)=>{t.setDepth(e.depth+1+i),t.x=e.x+20,t.y=e.y+25-i*18}),console.log(`${e.texture.key} levantó 3 ladrillos`)}}soltarLadrillo(e){if(e.ladrillos.length>0){const t=e.ladrillos.pop();t.portadorLadrillo=null,t.x=e.x+40,t.y=e.y+50,t.setDepth(0),t.setInteractive(),t.body.enable=!0,this.scene.physics.add.collider(t,this.scene.barreras),this.scene.physics.add.overlap(this.scene.Celeste,t,()=>{const i=this.scene.toca.Ladrillo.Celeste;i.includes(t)||i.push(t)},null,this),this.scene.physics.add.overlap(this.scene.Naranja,t,()=>{const i=this.scene.toca.Ladrillo.Naranja;i.includes(t)||i.push(t)},null,this),console.log(`${e.texture.key} soltó un ladrillo (${e.ladrillos.length}/3)`),e.ladrillos.length===0&&(e.ManosOcupadas=!1,e.llevaLadrillo=!1)}}levantarLadrilloSuelo(e,t){if(e.ladrillos.length<3&&!e.Aturdido&&t.portadorLadrillo===null){t.portadorLadrillo=e,e.ladrillos.push(t),e.ManosOcupadas=!0,e.llevaLadrillo=!0,t.body.enable=!1;const i=this.scene.toca.Ladrillo[e.texture.key],a=i.indexOf(t);a!==-1&&i.splice(a,1),e.ladrillos.forEach((s,o)=>{s.setDepth(e.depth+1+o),s.x=e.x+20,s.y=e.y+25-o*18}),console.log(`${e.texture.key} levantó un ladrillo del suelo (${e.ladrillos.length}/3)`)}}cargarMaquina(e,t,i){Phaser.Input.Keyboard.JustDown(t)&&this.texture.key==="Mezcladora"&&(i.texture.key==="Arena"&&this.arenaCount<2?this.arenaCount++:i.texture.key==="Grava"&&this.gravaCount<1&&this.gravaCount++,this.arenaCount===2&&this.gravaCount===1||(this.setTint(16776960),this.scene.time.delayedCall(500,()=>{this.setTint(16777215)})),this.vaciarBalde(),console.log(`${e.texture.key} cargó la mezcladora con ${i.texture.key}. Arena: ${this.arenaCount}/2, Grava: ${this.gravaCount}/1`),this.arenaCount===2&&this.gravaCount===1&&this.funcionar())}funcionar(){console.log("✅ ¡La mezcladora está funcionando!"),this.setTint(65280),this.scene.time.delayedCall(3e3,()=>{this.arenaCount=0,this.gravaCount=0,this.setTint(16777215),this.setTexture("MezcladoraLlena"),this.Cemento&&this.Cemento.destroy();const e=new B(this.scene,this.x-5,this.y+150,"Cemento").setScale(.5);e.usosRestantes=3,this.scene.Cemento=e,console.log("Se generó un balde de cemento"),console.log("La mezcladora está lista para otro uso")})}recibirCemento(e){(this.texture.key==="Construccion"||this.texture.key==="Construccion2"||this.texture.key==="Construccion3"&&e.llevaBalde&&this.scene.Balde.lleno&&["BaldeCemento"].includes(this.scene.Balde.texture.key))&&this.cementoCount<this.cementoNecesario&&(this.cementoCount++,this.scene.actualizarTextoConstruccion&&this.scene.actualizarTextoConstruccion(),this.scene.Balde.vaciarBalde(),this.cementoCount>=this.cementoNecesario&&this.ladrilloCount>=this.ladrilloNecesario||(this.setTint(13421772),this.scene.time.delayedCall(300,()=>this.setTint(16777215))),this.verificarConstruccion())}recibirLadrillo(e){if((this.texture.key==="Construccion"||this.texture.key==="Construccion2"||this.texture.key==="Construccion3"&&e.ladrillos.length>0)&&this.ladrilloCount<this.ladrilloNecesario){const t=e.ladrillos.pop();t&&(this.ladrilloCount++,this.scene.actualizarTextoConstruccion&&this.scene.actualizarTextoConstruccion(),t.destroy(),this.cementoCount>=this.cementoNecesario&&this.ladrilloCount>=this.ladrilloNecesario||(this.setTint(16764057),this.scene.time.delayedCall(300,()=>this.setTint(16777215))),this.verificarConstruccion(),e.ladrillos.length===0&&(e.ManosOcupadas=!1,e.llevaLadrillo=!1))}}etapa1Construccion(){for(let i=0;i<4;i++)this.scene.time.delayedCall(i*120,()=>{i%2===0?this.setTexture("Construccion2"):this.setTexture("Construccion")});this.scene.time.delayedCall(480,()=>{this.setTexture("Construccion2"),this.setDepth(this.depth+2),this.scene.sound.play("SonidoConstruccion",{volume:.75,rate:2}),console.log(" ¡Primera Construcción completada!"),this.scene.sumarTiempo&&this.scene.sumarTiempo(180)})}etapa2Construccion(){const e=this.width*this.scaleX,t=this.height*this.scaleY;this.body.setSize(e,t-38),this.body.setOffset(0,t-326),this.scene.add.image(this.x-140,this.y+155,"Pared").setScale(1).setDepth(2),this.scene.add.image(this.x+140,this.y+155,"Pared").setScale(1).setDepth(2),this.hitboxInternaCeleste||(this.hitboxInternaSupCeleste=this.scene.add.zone(this.x,this.y-200,e*.9,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInternaSupCeleste),this.hitboxInternaSupCeleste.body.setAllowGravity(!1),this.hitboxInternaSupCeleste.body.setImmovable(!0),this.hitboxInternaSupCeleste.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Celeste,this.hitboxInternaSupCeleste)),this.hitboxInfIzqCeleste||(this.hitboxInfIzqCeleste=this.scene.add.zone(this.x-140,this.y+150,e*.35,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInfIzqCeleste),this.hitboxInfIzqCeleste.body.setAllowGravity(!1),this.hitboxInfIzqCeleste.body.setImmovable(!0),this.hitboxInfIzqCeleste.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Celeste,this.hitboxInfIzqCeleste)),this.hitboxInfDerCeleste||(this.hitboxInfDerCeleste=this.scene.add.zone(this.x+140,this.y+150,e*.35,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInfDerCeleste),this.hitboxInfDerCeleste.body.setAllowGravity(!1),this.hitboxInfDerCeleste.body.setImmovable(!0),this.hitboxInfDerCeleste.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Celeste,this.hitboxInfDerCeleste)),this.hitboxInternaSupNaranja||(this.hitboxInternaSupNaranja=this.scene.add.zone(this.x,this.y-200,e*.9,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInternaSupNaranja),this.hitboxInternaSupNaranja.body.setAllowGravity(!1),this.hitboxInternaSupNaranja.body.setImmovable(!0),this.hitboxInternaSupNaranja.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Naranja,this.hitboxInternaSupNaranja)),this.hitboxInfIzqNaranja||(this.hitboxInfIzqNaranja=this.scene.add.zone(this.x-140,this.y+150,e*.35,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInfIzqNaranja),this.hitboxInfIzqNaranja.body.setAllowGravity(!1),this.hitboxInfIzqNaranja.body.setImmovable(!0),this.hitboxInfIzqNaranja.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Naranja,this.hitboxInfIzqNaranja)),this.hitboxInfDerNaranja||(this.hitboxInfDerNaranja=this.scene.add.zone(this.x+140,this.y+150,e*.35,t*.01).setOrigin(.5),this.scene.physics.add.existing(this.hitboxInfDerNaranja),this.hitboxInfDerNaranja.body.setAllowGravity(!1),this.hitboxInfDerNaranja.body.setImmovable(!0),this.hitboxInfDerNaranja.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Naranja,this.hitboxInfDerNaranja)),this.hitboxLateralIzq||(this.hitboxLateralIzq=this.scene.add.zone(this.x-e/2+10,this.y-25,20,t*.8).setOrigin(.5),this.scene.physics.add.existing(this.hitboxLateralIzq),this.hitboxLateralIzq.body.setAllowGravity(!1),this.hitboxLateralIzq.body.setImmovable(!0),this.hitboxLateralIzq.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Celeste,this.hitboxLateralIzq),this.scene.physics.add.collider(this.scene.Naranja,this.hitboxLateralIzq)),this.hitboxLateralDer||(this.hitboxLateralDer=this.scene.add.zone(this.x+e/2-10,this.y-25,20,t*.8).setOrigin(.5),this.scene.physics.add.existing(this.hitboxLateralDer),this.hitboxLateralDer.body.setAllowGravity(!1),this.hitboxLateralDer.body.setImmovable(!0),this.hitboxLateralDer.setDepth(this.depth+1),this.scene.physics.add.collider(this.scene.Celeste,this.hitboxLateralDer),this.scene.physics.add.collider(this.scene.Naranja,this.hitboxLateralDer)),this.y-=50,this.setDepth(1.5),this.setTexture("Construccion3"),this.scene.sound.play("SonidoConstruccion",{volume:.75,rate:2}),console.log(" ¡Segunda Construcción completada!"),this.scene.sumarTiempo&&this.scene.sumarTiempo(300)}verificarConstruccion(){this.cementoCount>=this.cementoNecesario&&this.ladrilloCount>=this.ladrilloNecesario&&(this.texture.key==="Construccion"?this.etapa1Construccion():this.texture.key==="Construccion2"&&this.etapa2Construccion(),this.cementoNecesario+=Phaser.Math.Between(1,2),this.ladrilloNecesario+=Phaser.Math.Between(3,4),this.cementoCount=0,this.ladrilloCount=0,this.scene.actualizarTextoConstruccion&&this.scene.actualizarTextoConstruccion())}update(){if(!this.scene)return;if(this.portadorBalde)this.x=this.portadorBalde.x+20,this.y=this.portadorBalde.y+50,this.setDepth(this.portadorBalde.depth+1);else if(this.portadorLadrillo){const i=this.portadorLadrillo.ladrillos.indexOf(this);this.x=this.portadorLadrillo.x,this.y=this.portadorLadrillo.y+25-i*18,this.setDepth(this.portadorLadrillo.depth+.1*(i+1))}if(this.texture.key!=="Construccion"&&this.texture.key!=="Construccion2"&&this.texture.key!=="Construccion3"&&!this.portadorBalde&&!this.portadorLadrillo){const i=[this.scene.Celeste,this.scene.Naranja];let a=1;for(const s of i)if(s&&Math.abs(s.x-this.x)<this.width*this.scaleX&&s.y<this.y+50){this.setDepth(s.depth+1),a=null;break}a!==null&&this.setDepth(1)}if(this.texture.key==="Construccion3"){const i=[this.scene.Celeste,this.scene.Naranja];for(const a of i)a&&Math.abs(a.x-this.x)<this.width*this.scaleX&&(a.y<this.y-205?a.setDepth(this.depth-1):a.setDepth(this.depth+1))}if(this.texture.key==="Pared"){const i=[this.scene.Celeste,this.scene.Naranja];for(const a of i)a&&Math.abs(a.x-this.x)<this.width*this.scaleX&&(a.y>this.y?a.setDepth(1.5):a.setDepth(2))}const e=this.scene&&typeof this.scene.anchoMapa=="number"?this.scene.anchoMapa:this.scene&&this.scene.cameras&&this.scene.cameras.main?this.scene.cameras.main.width:Number.POSITIVE_INFINITY,t=this.scene&&typeof this.scene.altoMapa=="number"?this.scene.altoMapa:this.scene&&this.scene.cameras&&this.scene.cameras.main?this.scene.cameras.main.height:Number.POSITIVE_INFINITY;if(this.texture.key==="Ladrillo"&&(this.x<0||this.x>e||this.y<0||this.y>t)&&(this.destroy(),console.log("Un ladrillo salió del mapa y fue destruido.")),this.texture.key==="Construccion3"){const i=this.scene.physics.overlap(this.scene.Celeste,this),a=this.scene.physics.overlap(this.scene.Naranja,this);i!==a?this.scene.colliderJugadores&&(this.scene.colliderJugadores.active=!1):this.scene.colliderJugadores&&!this.scene.colliderJugadores.active&&(this.scene.colliderJugadores.active=!0)}}}const u={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",NORTH:"north",EAST:"east",SOUTH:"south",WEST:"west"};class V{static ACTIONS=u;constructor(e){this.input=e,this.keys={},this.gamepad1=null,this.gamepad2=null,this.mapping={player1:{[u.UP]:{keyboard:[],gamepad:[{type:"axis",index:1,dir:-1}]},[u.DOWN]:{keyboard:[],gamepad:[{type:"axis",index:1,dir:1}]},[u.LEFT]:{keyboard:[],gamepad:[{type:"axis",index:0,dir:-1}]},[u.RIGHT]:{keyboard:[],gamepad:[{type:"axis",index:0,dir:1}]},[u.NORTH]:{keyboard:[],gamepad:[{type:"button",index:3}]},[u.EAST]:{keyboard:[],gamepad:[{type:"button",index:1}]},[u.SOUTH]:{keyboard:[],gamepad:[{type:"button",index:0}]},[u.WEST]:{keyboard:[],gamepad:[{type:"button",index:2}]}},player2:{[u.UP]:{keyboard:[],gamepad:[{type:"axis",index:1,dir:-1}]},[u.DOWN]:{keyboard:[],gamepad:[{type:"axis",index:1,dir:1}]},[u.LEFT]:{keyboard:[],gamepad:[{type:"axis",index:0,dir:-1}]},[u.RIGHT]:{keyboard:[],gamepad:[{type:"axis",index:0,dir:1}]},[u.NORTH]:{keyboard:[],gamepad:[{type:"button",index:3}]},[u.EAST]:{keyboard:[],gamepad:[{type:"button",index:1}]},[u.SOUTH]:{keyboard:[],gamepad:[{type:"button",index:0}]},[u.WEST]:{keyboard:[],gamepad:[{type:"button",index:2}]}}},this.previousAxisStates={player1:{},player2:{}},this.initializeKeyboard(),this.initializeGamepad()}initializeKeyboard(){["player1","player2"].forEach(e=>{Object.keys(this.mapping[e]).forEach(t=>{this.mapping[e][t].keyboard.forEach(a=>{typeof a=="string"?this.keys[a]=this.input.keyboard.addKey(a):this.keys[a]=this.input.keyboard.addKey(a)})})})}initializeGamepad(){this.input.gamepad&&(this.input.gamepad.on("connected",e=>{this.gamepad1?this.gamepad2?console.warn("Ya hay 2 gamepads conectados. Gamepad ignorado:",e.id):(this.gamepad2=e,console.log("Gamepad 2 conectado:",e.id,"- Index:",e.index)):(this.gamepad1=e,console.log("Gamepad 1 conectado:",e.id,"- Index:",e.index))}),this.input.gamepad.on("disconnected",e=>{this.gamepad1&&this.gamepad1.index===e.index?(this.gamepad1=null,console.log("Gamepad 1 desconectado")):this.gamepad2&&this.gamepad2.index===e.index&&(this.gamepad2=null,console.log("Gamepad 2 desconectado"))}),this.checkExistingGamepads())}checkExistingGamepads(){if(!this.input.gamepad)return;this.input.gamepad.gamepads.forEach(t=>{!t||!t.connected||this.gamepad1&&this.gamepad1.index===t.index||this.gamepad2&&this.gamepad2.index===t.index||(this.gamepad1?this.gamepad2||(this.gamepad2=t,console.log("Gamepad 2 detectado:",t.id,"- Index:",t.index)):(this.gamepad1=t,console.log("Gamepad 1 detectado:",t.id,"- Index:",t.index)))})}setMapping(e,t,i="player1"){this.mapping[i]&&(t.keyboard&&(this.mapping[i][e].keyboard=t.keyboard,t.keyboard.forEach(a=>{this.keys[a]||(this.keys[a]=this.input.keyboard.addKey(a))})),t.gamepad&&(this.mapping[i][e].gamepad=t.gamepad))}setMappings(e,t="player1"){Object.keys(e).forEach(i=>{this.setMapping(i,e[i],t)})}isPressed(e,t="player1"){return this.isKeyboardPressed(e,t)||this.isGamepadPressed(e,t)}isJustPressed(e,t="player1"){return this.isKeyboardJustPressed(e,t)||this.isGamepadJustPressed(e,t)}isKeyboardPressed(e,t="player1"){return!this.mapping[t]||!this.mapping[t][e]||!this.mapping[t][e].keyboard?!1:this.mapping[t][e].keyboard.some(i=>{const a=this.keys[i];return a&&a.isDown})}isKeyboardJustPressed(e,t="player1"){return!this.mapping[t]||!this.mapping[t][e]||!this.mapping[t][e].keyboard?!1:this.mapping[t][e].keyboard.some(i=>{const a=this.keys[i];return a&&Phaser.Input.Keyboard.JustDown(a)})}isGamepadPressed(e,t="player1"){const i=t==="player1"?this.gamepad1:this.gamepad2;return!i||!this.mapping[t]||!this.mapping[t][e]||!this.mapping[t][e].gamepad?!1:this.mapping[t][e].gamepad.some(a=>{if(a.type==="button")return i.buttons[a.index]&&i.buttons[a.index].pressed;if(a.type==="axis"){const s=i.axes[a.index].getValue();return a.dir>0?s>.5:s<-.5}return!1})}isGamepadJustPressed(e,t="player1"){const i=t==="player1"?this.gamepad1:this.gamepad2;return!i||!this.mapping[t]||!this.mapping[t][e]||!this.mapping[t][e].gamepad?!1:this.mapping[t][e].gamepad.some(a=>{if(a.type==="button"){const s=i.buttons[a.index];return s&&s.pressed&&s.duration<100}else if(a.type==="axis"){const s=i.axes[a.index].getValue(),o=.5,d=a.dir>0?s>o:s<-o,f=`axis_${a.index}_${a.dir}`,C=this.previousAxisStates[t][f];return this.previousAxisStates[t][f]=d,d&&!C}return!1})}getMapping(){return{...this.mapping}}configureKeyboard(e,t="player1"){this.mapping[t]&&Object.keys(e).forEach(i=>{this.mapping[t][i]&&(this.mapping[t][i].keyboard=e[i],e[i].forEach(a=>{this.keys[a]||(this.keys[a]=this.input.keyboard.addKey(a))}))})}configureKeyboardByString(e,t="player1"){const i={};Object.keys(e).forEach(a=>{i[a]=e[a].map(s=>{const o=Phaser.Input.Keyboard.KeyCodes[s.toUpperCase()];return o!==void 0?o:s})}),this.configureKeyboard(i,t)}getKeyboardMapping(e,t="player1"){return this.mapping[t]&&this.mapping[t][e]&&this.mapping[t][e].keyboard?[...this.mapping[t][e].keyboard]:[]}getAllKeyboardMappings(e="player1"){if(!this.mapping[e])return{};const t={};return Object.keys(this.mapping[e]).forEach(i=>{t[i]=this.getKeyboardMapping(i,e)}),t}isGamepadConnected(e="player1"){return e==="player1"?this.gamepad1!==null:this.gamepad2!==null}getGamepadInfo(e="player1"){const t=e==="player1"?this.gamepad1:this.gamepad2;return t?{id:t.id,index:t.index,connected:!0}:null}debugGamepad(e="player1"){const t=e==="player1"?this.gamepad1:this.gamepad2;if(!t)return null;const i=[],a=[];return t.buttons.forEach((s,o)=>{s.pressed&&i.push({index:o,value:s.value})}),t.axes.forEach((s,o)=>{const d=s.getValue();Math.abs(d)>.1&&a.push({index:o,value:d})}),{id:t.id,pressedButtons:i,axes:a,totalButtons:t.buttons.length,totalAxes:t.axes.length}}}class F extends Phaser.Scene{constructor(){super("game")}create(){this.cameras.main.setZoom(1),this.cameras.main.fadeIn(1e3);const e=this.cameras.main.width/2,t=this.cameras.main.height/2;console.log("CenterX:",e,"CenterY:",t),this.inputSystem=new V(this.input),this.inputSystem.configureKeyboard({[u.UP]:[Phaser.Input.Keyboard.KeyCodes.W],[u.DOWN]:[Phaser.Input.Keyboard.KeyCodes.S],[u.LEFT]:[Phaser.Input.Keyboard.KeyCodes.A],[u.RIGHT]:[Phaser.Input.Keyboard.KeyCodes.D],[u.EAST]:[Phaser.Input.Keyboard.KeyCodes.E],[u.SOUTH]:[Phaser.Input.Keyboard.KeyCodes.F],[u.WEST]:[Phaser.Input.Keyboard.KeyCodes.SHIFT]},"player1"),this.eKey=this.input.keyboard.addKey("E"),this.fKey=this.input.keyboard.addKey("F"),this.jKey=this.input.keyboard.addKey("J"),this.kKey=this.input.keyboard.addKey("K"),this.lKey=this.input.keyboard.addKey("L"),this.qKey=this.input.keyboard.addKey("Q"),this.cursors=this.input.keyboard.createCursorKeys();const i=0,a=0,s=this.cameras.main.width,o=this.cameras.main.height;this.anchoMapa=s,this.altoMapa=o,this.cameras.main.setBounds(i,a,s-i*2,o-a*2),this.pasto=this.add.image(e,t,"Pasto").setDisplaySize(this.cameras.main.width,this.cameras.main.height),this.add.image(e,t,"PastoDetalle").setOrigin(.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height).setAlpha(1).setDepth(1),this.add.image(e,t,"Borde").setDepth(5),this.Calles=this.physics.add.group(),this.CalleIZQ=this.add.image(e-210,t,"Calle").setOrigin(.5),this.CalleDER=this.add.image(e+210,t,"Calle").setOrigin(.5);const d=this.CalleIZQ.x,f=this.CalleDER.x,C=5,p=216,r=[],h=Math.floor(C/2);for(let n=0;n<C;n++)r.push(t+(n-h)*p);const m=Phaser.Math.Between(2,3),b=Phaser.Utils.Array.Shuffle(r).slice(0,m);this.barreras=[];for(const n of b){const l=this.physics.add.sprite(e,n,"Barrera").setImmovable(!0).setDepth(1);this.barreras.push(l)}this.Celeste=new E(this,e-500,t+125,"Celeste"),this.Naranja=new E(this,e-500,t+425,"Naranja"),this.jugadores=this.physics.add.group(),this.jugadores.add(this.Celeste),this.jugadores.add(this.Naranja),this.Celeste.setCollideWorldBounds(!0),this.Naranja.setCollideWorldBounds(!0),this.jugadores.Intangible=!1,this.jugadores.Aturdido=!1,this.jugadores.ManosOcupadas=!1,this.jugadores.setDepth(2),this.colliderJugadores=this.physics.add.collider(this.Celeste,this.Naranja),this.physics.add.collider(this.jugadores,this.barreras);const g=(this.Celeste.x+this.Naranja.x)/2,x=(this.Celeste.y+this.Naranja.y)/2;this.autos=this.physics.add.group({runChildUpdate:!0}),this.motos=this.physics.add.group({runChildUpdate:!0});const k=()=>{const n=[16711680,65280,255,16776960,16711935,65535];return n[Math.floor(Math.random()*n.length)]},c=[{x:d-80,y:-100},{x:d+80,y:-100},{x:f-80,y:1180},{x:f+80,y:1180}],M=()=>Phaser.Math.Between(600,800);this.time.addEvent({delay:M(),loop:!0,callback:()=>{let{x:n,y:l}=Phaser.Utils.Array.GetRandom(c);const y=l>t?-1:1;let v=k();const D=450;let N=!0;if(this.autos.getChildren().forEach(A=>{Math.abs(A.x-n)<10&&(y===1&&A.y<200||y===-1&&A.y>900)&&Math.abs(A.y-l)<D&&(N=!1)}),!N)return;const P=["Auto","Auto","Auto","Auto","Auto","Auto","Auto","Camion"];let L=Phaser.Utils.Array.GetRandom(P),T=600,z=.25,K="Camion";L==="Camion"&&(T=550,v=16777215,z=.35,y===1?l-=60:l+=60,n>e&&(K="Camion2"));const O=L==="Camion"?K:L;this.spawnVehicle(this.autos,n,l,O,{velocidad:T,color:v,direction:y,scale:z,immovable:!0})}}),this.physics.add.overlap(this.autos,this.jugadores,(n,l)=>{n.handleCollision(l),this.Balde.portadorBalde===l&&this.Balde.soltarBalde(l)},(n,l)=>!l.Intangible);const S=[{x:d,y:-100},{x:f,y:1180}],I=()=>Phaser.Math.Between(2e3,8e3);this.time.addEvent({delay:I(),loop:!0,callback:()=>{const{x:n,y:l}=Phaser.Utils.Array.GetRandom(S),y=l>t?-1:1;this.spawnVehicle(this.motos,n,l,"Moto",{velocidad:1e3,direction:y,scale:.25,size:{width:200,height:350},immovable:!0}),Phaser.Math.Between(1,5)===1&&this.sound.play("RuidoMoto",{volume:1})}}),this.physics.add.overlap(this.motos,this.jugadores,(n,l)=>{n.handleCollision(l),this.Balde.portadorBalde===l&&this.Balde.soltarBalde(l)},(n,l)=>!l.Intangible),this.sonidosCarretera=["SonidoCarretera","SonidoCarretera2"],this.reproducirCarretera=()=>{this.time.delayedCall(1e3,()=>{const n=Phaser.Utils.Array.GetRandom(this.sonidosCarretera),l=this.sound.add(n);l.once("complete",()=>{this.reproducirCarretera()}),n==="SonidoCarretera"?l.play({volume:.01,rate:1,detune:100}):n==="SonidoCarretera2"&&l.play({volume:.05,rate:1,detune:100})})},this.reproducirCarretera(),this.Arena=new B(this,e+700,t-300,"Arena").setScale(.5),this.Balde=new B(this,g,x,"Balde").setScale(.5).setDepth(0),this.Construccion=new B(this,e-649,t-175,"Construccion").setDepth(-1).setScale(1),this.Grava=new B(this,e+700,t+300,"Grava").setScale(.5),this.Ladrillos=new B(this,e+700,t,"Ladrillos").setScale(.5),this.Mezcladora=new B(this,e-800,x,"Mezcladora").setScale(.5),this.materiales=[this.Arena,this.Balde,this.Grava,this.Ladrillos,this.Mezcladora,this.Construccion],this.toca={Ladrillo:{Celeste:[],Naranja:[]}},this.iconoCemento=this.add.image(this.Construccion.x-80,this.Construccion.y,"BaldeCemento").setScale(.5).setDepth(4),this.textoCemento=this.add.text(this.iconoCemento.x,this.iconoCemento.y-80,"0/2",{fontFamily:"ActionComicsBlack",fontSize:"20px",color:"#ffffffff",stroke:"#000000ff",strokeThickness:4}).setOrigin(.5,0).setDepth(4),this.iconoLadrillo=this.add.image(this.Construccion.x+80,this.Construccion.y+10,"Ladrillo").setScale(.65).setDepth(4),this.textoLadrillo=this.add.text(this.iconoLadrillo.x,this.iconoLadrillo.y-90,"0/3",{fontFamily:"ActionComicsBlack",fontSize:"20px",color:"#ffffffff",stroke:"#000000ff",strokeThickness:4}).setOrigin(.5,0).setDepth(4),this.actualizarTextoConstruccion=()=>{const n=this.Construccion.cementoCount||0,l=this.Construccion.ladrilloCount||0,y=this.Construccion.cementoNecesario||2,v=this.Construccion.ladrilloNecesario||3;this.textoCemento.setText(`${n}/${y}`),this.textoLadrillo.setText(`${l}/${v}`),n>=y?this.textoCemento.setColor("#00ff00"):this.textoCemento.setColor("#ffffffff"),l>=v?this.textoLadrillo.setColor("#00ff00"):this.textoLadrillo.setColor("#ffffffff")},this.materiales.forEach(n=>{n.hitboxInterna&&(this.physics.add.collider(this.Celeste,n.hitboxInterna),this.physics.add.collider(this.Naranja,n.hitboxInterna))}),this.tiempoRestante=240,this.textoTimer=this.add.text(150,60,"04:00",{fontFamily:"ActionComicsBlack",fontSize:"40px",color:"#ffffffff",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setDepth(4),this.gameOverMostrado=!1}spawnVehicle(e,t,i,a,s={}){const o=new G(this,t,i,a);return e.add(o),o.configure(s),o}interactuar(e,t){if(!e.aiming&&Phaser.Input.Keyboard.JustDown(t))if(this.physics.overlap(e,this.Balde))this.Balde.interactuarBalde(e,t);else if(this.physics.overlap(e,this.Ladrillos)&&e.ladrillos.length<3&&!e.Aturdido&&!e.ManosOcupadas)this.Ladrillos.levantarLadrillo(e);else if(this.toca.Ladrillo[e.texture.key].length>0&&e.ladrillos.length<3&&!e.Aturdido){const i=this.toca.Ladrillo[e.texture.key][0];i.levantarLadrilloSuelo(e,i)}else!this.physics.overlap(e,this.Ladrillos)&&e.ladrillos.length>0&&e.ladrillos[e.ladrillos.length-1].soltarLadrillo(e)}interactuarConstruccion(e,t){e.aiming||Phaser.Input.Keyboard.JustDown(t)&&(this.physics.overlap(e,this.Construccion)&&e.llevaBalde&&this.Balde.lleno&&this.Balde.texture.key==="BaldeCemento"?this.Construccion.recibirCemento(e):this.physics.overlap(e,this.Construccion)&&e.ladrillos.length>0&&this.Construccion.recibirLadrillo(e))}interactuarMaterial(e,t,i){e.aiming||this.physics.overlap(e,i)&&e.llevaBalde&&this.Balde.llenarBalde(e,t,i)}interactuarMezcladora(e,t){e.aiming||this.physics.overlap(e,this.Mezcladora)&&e.llevaBalde&&(this.Balde.texture.key==="BaldeArena"?this.Mezcladora.cargarMaquina(e,t,this.Arena):this.Balde.texture.key==="BaldeGrava"&&this.Mezcladora.cargarMaquina(e,t,this.Grava))}interactuarLadrillo(e,t){this.physics.overlap(e,this.Construccion)||Phaser.Input.Keyboard.JustDown(t)&&(e.texture.key==="Celeste"?this.Celeste.aiming?this.Celeste.lanzarLadrillo():this.Celeste.startAiming():e.texture.key==="Naranja"&&(this.Naranja.aiming?this.Naranja.lanzarLadrillo():this.Naranja.startAiming()))}sumarTiempo(e){this.tiempoRestante+=e;const t=Math.floor(this.tiempoRestante/60),i=Math.floor(this.tiempoRestante%60),a=`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`;this.textoTimer&&this.textoTimer.setText(a)}moverJugador(e,t,i){let s=e.velocidadBase;if(e.llevaBalde&&this.Balde.lleno?s=150:e.ladrillos&&e.ladrillos.length>0&&(s=e.velocidadBase-45*e.ladrillos.length,s<60&&(s=60)),e.aiming){if(!e.aimCursor||!e.aimCursor.scene){const b=e.texture&&e.texture.key==="Naranja"?"MiraNaranja":"MiraCeleste";e.aimCursor=this.add.image(e.x+80,e.y,b).setScale(.25).setDepth(3).setAlpha(.95)}const o=1e3;let d=0,f=0;t.izq.isDown?d=-o:t.der.isDown&&(d=o),t.arriba.isDown?f=-o:t.abajo.isDown&&(f=o);const C=this.game&&this.game.loop&&this.game.loop.delta?this.game.loop.delta/1e3:.016;e.aimCursor.x+=d*C,e.aimCursor.y+=f*C;const p=this.cameras.main.scrollX+20,r=this.cameras.main.scrollX+this.cameras.main.displayWidth-20,h=this.cameras.main.scrollY+20,m=this.cameras.main.scrollY+this.cameras.main.displayHeight-20;e.aimCursor.x=Phaser.Math.Clamp(e.aimCursor.x,p,r),e.aimCursor.y=Phaser.Math.Clamp(e.aimCursor.y,h,m),e.setVelocity(0,0);return}if(e.Aturdido)e.setVelocity(0);else{let o=0,d=0;t.izq.isDown?(o=-s,e.setFlipX(!1)):t.der.isDown&&(o=s,e.setFlipX(!0)),t.arriba.isDown?d=-s:t.abajo.isDown&&(d=s),i&&i.isDown&&(o*=1.5,d*=1.5),e.setVelocityX(o),e.setVelocityY(d)}}update(){if(this.gameOverMostrado){this.Celeste.setVelocity(0,0),this.Naranja.setVelocity(0,0),this.autos.getChildren().forEach(s=>s.setVelocity(0,0)),this.motos.getChildren().forEach(s=>s.setVelocity(0,0)),this.materiales.forEach(s=>{s.body&&s.body.setVelocity(0,0)}),this.colliderJugadores&&(this.colliderJugadores.active=!1),this.physics.world.colliders.getActive().forEach(s=>{s.active=!1});return}const e={izq:this.input.keyboard.addKey("A")||this.inputSystem.isPressed(u.LEFT,"player1"),der:this.input.keyboard.addKey("D")||this.inputSystem.isPressed(u.RIGHT,"player1"),arriba:this.input.keyboard.addKey("W")||this.inputSystem.isPressed(u.UP,"player1"),abajo:this.input.keyboard.addKey("S")||this.inputSystem.isPressed(u.DOWN,"player1")},t=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),i={izq:this.cursors.left,der:this.cursors.right,arriba:this.cursors.up,abajo:this.cursors.down},a=this.lKey;if(this.moverJugador(this.Celeste,e,t),this.moverJugador(this.Naranja,i,a),this.interactuar(this.Celeste,this.eKey),this.interactuar(this.Naranja,this.jKey),this.interactuarMaterial(this.Celeste,this.fKey,this.Arena,"Arena"),this.interactuarMaterial(this.Naranja,this.kKey,this.Arena,"Arena"),this.interactuarMaterial(this.Celeste,this.fKey,this.Grava,"Grava"),this.interactuarMaterial(this.Naranja,this.kKey,this.Grava,"Grava"),this.interactuarMaterial(this.Celeste,this.fKey,this.Cemento,"Cemento"),this.interactuarMaterial(this.Naranja,this.kKey,this.Cemento,"Cemento"),this.interactuarMezcladora(this.Celeste,this.fKey),this.interactuarMezcladora(this.Naranja,this.kKey),this.interactuarLadrillo(this.Celeste,this.fKey),this.interactuarLadrillo(this.Naranja,this.kKey),this.interactuarConstruccion(this.Celeste,this.fKey),this.interactuarConstruccion(this.Naranja,this.kKey),[this.Celeste,this.Naranja].forEach(s=>{s.llevaBalde&&this.Balde.lleno&&this.Balde.texture.key!=="Balde"&&(s===this.Celeste?this.fKey:this.kKey).isDown?s.vaciarTimer||(s.vaciarTimer=this.time.delayedCall(1e3,()=>{this.Balde.vaciarBalde(),s.vaciarTimer=null})):s.vaciarTimer&&(s.vaciarTimer.remove(),s.vaciarTimer=null)}),this.Construccion.texture.key!=="Construccion"?this.pasto.setTexture("Pasto2"):this.pasto.setTexture("Pasto"),this.Balde.update(),[this.Celeste,this.Naranja].forEach(s=>{s.ladrillos&&s.ladrillos.length>0&&s.ladrillos.forEach(o=>o.update())}),this.actualizarTextoConstruccion(),[this.Celeste,this.Naranja].forEach(s=>{typeof s.estabaEnConstruccion>"u"&&(s.estabaEnConstruccion=!1);const o=this.physics.overlap(s,this.Construccion)&&this.Construccion.texture.key==="Construccion",d=o?.28:.3;s.estabaEnConstruccion!==o&&(this.tweens.add({targets:s,scale:d,duration:400,ease:"Sine.easeInOut"}),s.estabaEnConstruccion=o)}),this.toca.Ladrillo.Celeste=this.toca.Ladrillo.Celeste.filter(s=>this.physics.overlap(this.Celeste,s)),this.toca.Ladrillo.Naranja=this.toca.Ladrillo.Naranja.filter(s=>this.physics.overlap(this.Naranja,s)),this.materiales.forEach(s=>{s&&typeof s.update=="function"&&s.update()}),this.Construccion.hitboxInternaSupCeleste&&(this.physics.overlap(this.Celeste,this.Construccion)?this.Construccion.hitboxInternaSupCeleste.setSize(405,205):this.Construccion.hitboxInternaSupCeleste.setSize(405,9)),this.Construccion.hitboxInternaSupNaranja&&(this.physics.overlap(this.Naranja,this.Construccion)?this.Construccion.hitboxInternaSupNaranja.setSize(405,205):this.Construccion.hitboxInternaSupNaranja.setSize(405,9)),!this.gameOverMostrado)if(this.tiempoRestante>0){this.tiempoRestante-=this.game.loop.delta/1e3,this.tiempoRestante<0&&(this.tiempoRestante=0);const s=Math.floor(this.tiempoRestante/60),o=Math.floor(this.tiempoRestante%60),d=`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;this.textoTimer.setText(d),this.tiempoRestante<=10?this.textoTimer.setColor("#ff0000"):this.textoTimer.setColor("#ffffffff")}else this.gameOverMostrado=!0,this.textoTimer.destroy(),this.add.rectangle(this.cameras.main.width/2,this.cameras.main.height/2,this.cameras.main.width,this.cameras.main.height,0,.7).setDepth(4),this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"GAME OVER",{fontFamily:"ActionComicsBlack",fontSize:"80px",color:"#ff0000",stroke:"#000000",strokeThickness:8}).setOrigin(.5).setDepth(4)}}class q extends Phaser.Scene{constructor(){super("gamepvp")}create(){this.cameras.main.setZoom(1),this.cameras.main.fadeIn(1e3);const e=this.cameras.main.width/2,t=this.cameras.main.height/2;console.log("CenterX:",e,"CenterY:",t),this.eKey=this.input.keyboard.addKey("E"),this.fKey=this.input.keyboard.addKey("F"),this.jKey=this.input.keyboard.addKey("J"),this.kKey=this.input.keyboard.addKey("K"),this.lKey=this.input.keyboard.addKey("L"),this.qKey=this.input.keyboard.addKey("Q"),this.cursors=this.input.keyboard.createCursorKeys();const i=0,a=0,s=this.cameras.main.width,o=this.cameras.main.height;this.anchoMapa=s,this.altoMapa=o,this.cameras.main.setBounds(i,a,s-i*2,o-a*2),this.pasto=this.add.image(e,t,"Pasto").setDisplaySize(this.cameras.main.width,this.cameras.main.height),this.add.image(e,t,"PastoDetalle").setOrigin(.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height).setAlpha(1).setDepth(1),this.add.image(e,t,"Borde").setDepth(5),this.Calles=this.physics.add.group(),this.CalleIZQ=this.add.image(e-210,t,"Calle").setOrigin(.5),this.CalleDER=this.add.image(e+210,t,"Calle").setOrigin(.5);const d=this.CalleIZQ.x,f=this.CalleDER.x,C=5,p=216,r=[],h=Math.floor(C/2);for(let n=0;n<C;n++)r.push(t+(n-h)*p);const m=Phaser.Math.Between(2,3),b=Phaser.Utils.Array.Shuffle(r).slice(0,m);this.barreras=[];for(const n of b){const l=this.physics.add.sprite(e,n,"Barrera").setImmovable(!0).setDepth(1);this.barreras.push(l)}this.Celeste=new E(this,e-500,t+125,"Celeste"),this.Naranja=new E(this,e-500,t+425,"Naranja"),this.jugadores=this.physics.add.group(),this.jugadores.add(this.Celeste),this.jugadores.add(this.Naranja),this.Celeste.setCollideWorldBounds(!0),this.Naranja.setCollideWorldBounds(!0),this.jugadores.Intangible=!1,this.jugadores.Aturdido=!1,this.jugadores.ManosOcupadas=!1,this.jugadores.setDepth(2),this.colliderJugadores=this.physics.add.collider(this.Celeste,this.Naranja),this.physics.add.collider(this.jugadores,this.barreras);const g=(this.Celeste.x+this.Naranja.x)/2,x=(this.Celeste.y+this.Naranja.y)/2;this.autos=this.physics.add.group({runChildUpdate:!0}),this.motos=this.physics.add.group({runChildUpdate:!0});const k=()=>{const n=[16711680,65280,255,16776960,16711935,65535];return n[Math.floor(Math.random()*n.length)]},c=[{x:d-80,y:-100},{x:d+80,y:-100},{x:f-80,y:1180},{x:f+80,y:1180}],M=()=>Phaser.Math.Between(400,500);this.time.addEvent({delay:M(),loop:!0,callback:()=>{let{x:n,y:l}=Phaser.Utils.Array.GetRandom(c);const y=l>t?-1:1;let v=k();const D=450;let N=!0;if(this.autos.getChildren().forEach(A=>{Math.abs(A.x-n)<10&&(y===1&&A.y<200||y===-1&&A.y>900)&&Math.abs(A.y-l)<D&&(N=!1)}),!N)return;const P=["Auto","Auto","Auto","Auto","Auto","Auto","Auto","Camion"];let L=Phaser.Utils.Array.GetRandom(P),T=600,z=.25,K="Camion";L==="Camion"&&(T=550,v=16777215,z=.35,y===1?l-=60:l+=60,n>e&&(K="Camion2"));const O=L==="Camion"?K:L;this.spawnVehicle(this.autos,n,l,O,{velocidad:T,color:v,direction:y,scale:z,immovable:!0})}}),this.physics.add.overlap(this.autos,this.jugadores,(n,l)=>{n.handleCollision(l),this.Balde.portadorBalde===l&&this.Balde.soltarBalde(l)},(n,l)=>!l.Intangible);const S=[{x:d,y:-100},{x:f,y:1180}],I=()=>Phaser.Math.Between(2e3,8e3);this.time.addEvent({delay:I(),loop:!0,callback:()=>{const{x:n,y:l}=Phaser.Utils.Array.GetRandom(S),y=l>t?-1:1;this.spawnVehicle(this.motos,n,l,"Moto",{velocidad:1e3,direction:y,scale:.25,size:{width:200,height:350},immovable:!0}),Phaser.Math.Between(1,5)===1&&this.sound.play("RuidoMoto",{volume:1})}}),this.physics.add.overlap(this.motos,this.jugadores,(n,l)=>{n.handleCollision(l),this.Balde.portadorBalde===l&&this.Balde.soltarBalde(l)},(n,l)=>!l.Intangible),this.sonidosCarretera=["SonidoCarretera","SonidoCarretera2"],this.reproducirCarretera=()=>{this.time.delayedCall(1e3,()=>{const n=Phaser.Utils.Array.GetRandom(this.sonidosCarretera),l=this.sound.add(n);l.once("complete",()=>{this.reproducirCarretera()}),n==="SonidoCarretera"?l.play({volume:.01,rate:1,detune:100}):n==="SonidoCarretera2"&&l.play({volume:.05,rate:1,detune:100})})},this.reproducirCarretera(),this.Arena=new B(this,e+700,t-300,"Arena").setScale(.5),this.Balde=new B(this,g,x,"Balde").setScale(.5).setDepth(0),this.Construccion=new B(this,e-649,t-175,"Construccion").setDepth(-1).setScale(1),this.Grava=new B(this,e+700,t+300,"Grava").setScale(.5),this.Ladrillos=new B(this,e+700,t,"Ladrillos").setScale(.5),this.Mezcladora=new B(this,e-800,x,"Mezcladora").setScale(.5),this.materiales=[this.Arena,this.Balde,this.Grava,this.Ladrillos,this.Mezcladora,this.Construccion],this.toca={Ladrillo:{Celeste:[],Naranja:[]}},this.iconoCemento=this.add.image(this.Construccion.x-80,this.Construccion.y,"BaldeCemento").setScale(.5).setDepth(4),this.textoCemento=this.add.text(this.iconoCemento.x,this.iconoCemento.y-80,"0/2",{fontFamily:"ActionComicsBlack",fontSize:"20px",color:"#ffffffff",stroke:"#000000ff",strokeThickness:4}).setOrigin(.5,0).setDepth(4),this.iconoLadrillo=this.add.image(this.Construccion.x+80,this.Construccion.y+10,"Ladrillo").setScale(.65).setDepth(4),this.textoLadrillo=this.add.text(this.iconoLadrillo.x,this.iconoLadrillo.y-90,"0/3",{fontFamily:"ActionComicsBlack",fontSize:"20px",color:"#ffffffff",stroke:"#000000ff",strokeThickness:4}).setOrigin(.5,0).setDepth(4),this.actualizarTextoConstruccion=()=>{const n=this.Construccion.cementoCount||0,l=this.Construccion.ladrilloCount||0,y=this.Construccion.cementoNecesario||2,v=this.Construccion.ladrilloNecesario||3;this.textoCemento.setText(`${n}/${y}`),this.textoLadrillo.setText(`${l}/${v}`),n>=y?this.textoCemento.setColor("#00ff00"):this.textoCemento.setColor("#ffffffff"),l>=v?this.textoLadrillo.setColor("#00ff00"):this.textoLadrillo.setColor("#ffffffff")},this.materiales.forEach(n=>{n.hitboxInterna&&(this.physics.add.collider(this.Celeste,n.hitboxInterna),this.physics.add.collider(this.Naranja,n.hitboxInterna))}),this.tiempoRestante=240,this.textoTimer=this.add.text(150,60,"04:00",{fontFamily:"ActionComicsBlack",fontSize:"40px",color:"#ffffffff",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setDepth(4),this.gameOverMostrado=!1}spawnVehicle(e,t,i,a,s={}){const o=new G(this,t,i,a);return e.add(o),o.configure(s),o}interactuar(e,t){if(!e.aiming&&Phaser.Input.Keyboard.JustDown(t))if(this.physics.overlap(e,this.Balde))this.Balde.interactuarBalde(e,t);else if(this.physics.overlap(e,this.Ladrillos)&&e.ladrillos.length<3&&!e.Aturdido&&!e.ManosOcupadas)this.Ladrillos.levantarLadrillo(e);else if(this.toca.Ladrillo[e.texture.key].length>0&&e.ladrillos.length<3&&!e.Aturdido){const i=this.toca.Ladrillo[e.texture.key][0];i.levantarLadrilloSuelo(e,i)}else!this.physics.overlap(e,this.Ladrillos)&&e.ladrillos.length>0&&e.ladrillos[e.ladrillos.length-1].soltarLadrillo(e)}interactuarConstruccion(e,t){e.aiming||Phaser.Input.Keyboard.JustDown(t)&&(this.physics.overlap(e,this.Construccion)&&e.llevaBalde&&this.Balde.lleno&&this.Balde.texture.key==="BaldeCemento"?this.Construccion.recibirCemento(e):this.physics.overlap(e,this.Construccion)&&e.ladrillos.length>0&&this.Construccion.recibirLadrillo(e))}interactuarMaterial(e,t,i){e.aiming||this.physics.overlap(e,i)&&e.llevaBalde&&this.Balde.llenarBalde(e,t,i)}interactuarMezcladora(e,t){e.aiming||this.physics.overlap(e,this.Mezcladora)&&e.llevaBalde&&(this.Balde.texture.key==="BaldeArena"?this.Mezcladora.cargarMaquina(e,t,this.Arena):this.Balde.texture.key==="BaldeGrava"&&this.Mezcladora.cargarMaquina(e,t,this.Grava))}interactuarLadrillo(e,t){this.physics.overlap(e,this.Construccion)||Phaser.Input.Keyboard.JustDown(t)&&(e.texture.key==="Celeste"?this.Celeste.aiming?this.Celeste.lanzarLadrillo():this.Celeste.startAiming():e.texture.key==="Naranja"&&(this.Naranja.aiming?this.Naranja.lanzarLadrillo():this.Naranja.startAiming()))}moverJugador(e,t,i){let s=e.velocidadBase;if(e.llevaBalde&&this.Balde.lleno?s=150:e.ladrillos&&e.ladrillos.length>0&&(s=e.velocidadBase-45*e.ladrillos.length,s<60&&(s=60)),e.aiming){if(!e.aimCursor||!e.aimCursor.scene){const b=e.texture&&e.texture.key==="Naranja"?"MiraNaranja":"MiraCeleste";e.aimCursor=this.add.image(e.x+80,e.y,b).setScale(.25).setDepth(3).setAlpha(.95)}const o=1e3;let d=0,f=0;t.izq.isDown?d=-o:t.der.isDown&&(d=o),t.arriba.isDown?f=-o:t.abajo.isDown&&(f=o);const C=this.game&&this.game.loop&&this.game.loop.delta?this.game.loop.delta/1e3:.016;e.aimCursor.x+=d*C,e.aimCursor.y+=f*C;const p=this.cameras.main.scrollX+20,r=this.cameras.main.scrollX+this.cameras.main.displayWidth-20,h=this.cameras.main.scrollY+20,m=this.cameras.main.scrollY+this.cameras.main.displayHeight-20;e.aimCursor.x=Phaser.Math.Clamp(e.aimCursor.x,p,r),e.aimCursor.y=Phaser.Math.Clamp(e.aimCursor.y,h,m),e.setVelocity(0,0);return}if(e.Aturdido)e.setVelocity(0);else{let o=0,d=0;t.izq.isDown?(o=-s,e.setFlipX(!1)):t.der.isDown&&(o=s,e.setFlipX(!0)),t.arriba.isDown?d=-s:t.abajo.isDown&&(d=s),i&&i.isDown&&(o*=1.5,d*=1.5),e.setVelocityX(o),e.setVelocityY(d)}}update(){if(this.gameOverMostrado){this.Celeste.setVelocity(0,0),this.Naranja.setVelocity(0,0),this.autos.getChildren().forEach(s=>s.setVelocity(0,0)),this.motos.getChildren().forEach(s=>s.setVelocity(0,0)),this.materiales.forEach(s=>{s.body&&s.body.setVelocity(0,0)}),this.colliderJugadores&&(this.colliderJugadores.active=!1),this.physics.world.colliders.getActive().forEach(s=>{s.active=!1});return}const e={izq:this.input.keyboard.addKey("A"),der:this.input.keyboard.addKey("D"),arriba:this.input.keyboard.addKey("W"),abajo:this.input.keyboard.addKey("S")},t=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),i={izq:this.cursors.left,der:this.cursors.right,arriba:this.cursors.up,abajo:this.cursors.down},a=this.lKey;if(this.moverJugador(this.Celeste,e,t),this.moverJugador(this.Naranja,i,a),this.interactuar(this.Celeste,this.eKey),this.interactuar(this.Naranja,this.jKey),this.interactuarMaterial(this.Celeste,this.fKey,this.Arena,"Arena"),this.interactuarMaterial(this.Naranja,this.kKey,this.Arena,"Arena"),this.interactuarMaterial(this.Celeste,this.fKey,this.Grava,"Grava"),this.interactuarMaterial(this.Naranja,this.kKey,this.Grava,"Grava"),this.interactuarMaterial(this.Celeste,this.fKey,this.Cemento,"Cemento"),this.interactuarMaterial(this.Naranja,this.kKey,this.Cemento,"Cemento"),this.interactuarMezcladora(this.Celeste,this.fKey),this.interactuarMezcladora(this.Naranja,this.kKey),this.interactuarLadrillo(this.Celeste,this.fKey),this.interactuarLadrillo(this.Naranja,this.kKey),this.interactuarConstruccion(this.Celeste,this.fKey),this.interactuarConstruccion(this.Naranja,this.kKey),[this.Celeste,this.Naranja].forEach(s=>{s.llevaBalde&&this.Balde.lleno&&this.Balde.texture.key!=="Balde"&&(s===this.Celeste?this.fKey:this.kKey).isDown?s.vaciarTimer||(s.vaciarTimer=this.time.delayedCall(1e3,()=>{this.Balde.vaciarBalde(),s.vaciarTimer=null})):s.vaciarTimer&&(s.vaciarTimer.remove(),s.vaciarTimer=null)}),this.Construccion.texture.key!=="Construccion"?this.pasto.setTexture("Pasto2"):this.pasto.setTexture("Pasto"),this.Balde.update(),[this.Celeste,this.Naranja].forEach(s=>{s.ladrillos&&s.ladrillos.length>0&&s.ladrillos.forEach(o=>o.update())}),this.actualizarTextoConstruccion(),[this.Celeste,this.Naranja].forEach(s=>{typeof s.estabaEnConstruccion>"u"&&(s.estabaEnConstruccion=!1);const o=this.physics.overlap(s,this.Construccion)&&this.Construccion.texture.key==="Construccion",d=o?.28:.3;s.estabaEnConstruccion!==o&&(this.tweens.add({targets:s,scale:d,duration:400,ease:"Sine.easeInOut"}),s.estabaEnConstruccion=o)}),this.toca.Ladrillo.Celeste=this.toca.Ladrillo.Celeste.filter(s=>this.physics.overlap(this.Celeste,s)),this.toca.Ladrillo.Naranja=this.toca.Ladrillo.Naranja.filter(s=>this.physics.overlap(this.Naranja,s)),this.materiales.forEach(s=>{s&&typeof s.update=="function"&&s.update()}),this.Construccion.hitboxInternaSupCeleste&&(this.physics.overlap(this.Celeste,this.Construccion)?this.Construccion.hitboxInternaSupCeleste.setSize(405,205):this.Construccion.hitboxInternaSupCeleste.setSize(405,9)),this.Construccion.hitboxInternaSupNaranja&&(this.physics.overlap(this.Naranja,this.Construccion)?this.Construccion.hitboxInternaSupNaranja.setSize(405,205):this.Construccion.hitboxInternaSupNaranja.setSize(405,9)),!this.gameOverMostrado)if(this.tiempoRestante>0){this.tiempoRestante-=this.game.loop.delta/1e3,this.tiempoRestante<0&&(this.tiempoRestante=0);const s=Math.floor(this.tiempoRestante/60),o=Math.floor(this.tiempoRestante%60),d=`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;this.textoTimer.setText(d),this.tiempoRestante<=10?this.textoTimer.setColor("#ff0000"):this.textoTimer.setColor("#ffffffff")}else this.gameOverMostrado=!0,this.textoTimer.destroy(),this.add.rectangle(this.cameras.main.width/2,this.cameras.main.height/2,this.cameras.main.width,this.cameras.main.height,0,.7).setDepth(4),this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"GAME OVER",{fontFamily:"ActionComicsBlack",fontSize:"80px",color:"#ff0000",stroke:"#000000",strokeThickness:8}).setOrigin(.5).setDepth(4)}}const U={type:Phaser.AUTO,width:1920,height:1080,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{gamepad:!0},physics:{default:"arcade",arcade:{debug:!1}},scene:[R,F,q]};document.fonts.load("1em ActionComicsBlack").then(()=>{window.game=new Phaser.Game(U)});
